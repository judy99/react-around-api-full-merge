(this["webpackJsonparound-react"]=this["webpackJsonparound-react"]||[]).push([[0],{24:function(e,t,a){e.exports=a(35)},29:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(18),i=a.n(o),c=a(4),l=(a(29),a(22)),s=a(11),u=a(1),m=a(2),p=a(23),d=function(e){var t=e.component,a=Object(p.a)(e,["component"]);return r.a.createElement(m.b,null,(function(){return a.loggedIn?r.a.createElement(t,a):r.a.createElement(m.a,{to:"./signin"})}))};var f=function(){return r.a.createElement("footer",{className:"footer"},r.a.createElement("p",{className:"footer__copyright"},"\xa9 2020 Around The U.S."))},h=r.a.createContext();var _=function(e){var t=r.a.useContext(h),a=r.a.useState(e.card.likes.some((function(e){return e===t._id}))),n=Object(u.a)(a,2),o=n[0],i=n[1],c=r.a.useState(e.cardLikes.length),l=Object(u.a)(c,2),s=l[0],m=l[1],p=e.card.owner===t._id,d="btn gallery__icon-trash ".concat(p?" ":"gallery__icon-trash_hidden"),f="btn gallery__like ".concat(o?"gallery__like_active":""," ");return r.a.useEffect((function(){i(e.cardLikes.some((function(e){return e===t._id}))),m(e.cardLikes.length)}),[e.cardLikes]),r.a.createElement("li",{className:"gallery__item",onClick:function(t){e.onCardClick(e.card)},style:{backgroundImage:"url(".concat(e.card.link,")")}},r.a.createElement("button",{className:d,onClick:function(t){t.stopPropagation(),e.onCardDelete(e.card)}}),r.a.createElement("div",{className:"gallery__bottom"},r.a.createElement("h2",{className:"gallery__title"},e.card.name),r.a.createElement("div",{className:"gallery__like-wrapper"},r.a.createElement("button",{className:f,onClick:function(t){t.stopPropagation(),i(!o),m(o?s-1:s+1),e.onCardLike(e.card)}}),r.a.createElement("div",{className:"gallery__score"},s))))};var g=function(e){return r.a.createElement("header",{className:"header"},r.a.createElement("a",{href:"/",className:"link header__logo logo"},"Around",r.a.createElement("span",{className:"logo__small"},"The U.S.")),r.a.createElement("ul",{className:"menu"},e.children))};var E=function(e){return r.a.createElement("div",{className:"popup ".concat(e.isOpen?"popup_opened":"")},r.a.createElement("div",{className:"popup__container"},r.a.createElement("span",{className:"popup__close",onClick:e.onClose},"+"),r.a.createElement("form",{action:"#",method:"post",className:"form ".concat(e.name),name:"".concat(e.name),onSubmit:e.onSubmit,noValidate:!0},r.a.createElement("h2",{className:"".concat(e.name,"__heading")},e.title),e.children,r.a.createElement("input",{type:"submit",name:"save",className:"btn form__submit ".concat(e.name,"__save"),value:e.value}))))};var v=function(e){var t=r.a.useContext(h),a=r.a.useState(""),n=Object(u.a)(a,2),o=n[0],i=n[1],c=r.a.useState(""),l=Object(u.a)(c,2),s=l[0],m=l[1];return r.a.useEffect((function(){i(o||t.name),m(s||t.about)}),[t.name,t.about]),r.a.createElement(E,{title:"Edit profile",name:"edit-profile",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:o,about:s})},value:"Save"},r.a.createElement("input",{type:"text",name:"name",id:"name-input",className:"form__input edit-profile__name",placeholder:"Name",minLength:"2",maxLength:"40",value:o||"",onChange:function(e){i(e.target.value)},required:!0}),r.a.createElement("span",{id:"name-input-error",className:"form__input-error"}),r.a.createElement("input",{type:"text",name:"job",id:"job-input",className:"form__input edit-profile__job",placeholder:"About me",minLength:"2",maxLength:"200",onChange:function(e){m(e.target.value)},value:s||"",required:!0}),r.a.createElement("span",{id:"job-input-error",className:"form__input-error"}))};var b=function(e){var t=r.a.useRef();return Object(n.useEffect)((function(){t.current.value=""}),[e.isOpen]),r.a.createElement(E,{title:"Change profile picture",name:"change-avatar",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(a){a.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})},value:"Save"},r.a.createElement("input",{type:"url",name:"avatar-link",id:"avatar-input",ref:t,className:"form__input change-avatar__link",placeholder:"Image URL",required:!0}),r.a.createElement("span",{id:"avatar-input-error",className:"form__input-error"}))};var k=function(e){var t=r.a.useState(""),a=Object(u.a)(t,2),o=a[0],i=a[1],c=r.a.useState(""),l=Object(u.a)(c,2),s=l[0],m=l[1];return Object(n.useEffect)((function(){i(""),m("")}),[e.isOpen]),r.a.createElement(E,{title:"New place",name:"add-card",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:o,link:s})},value:"Add place"},r.a.createElement("input",{type:"text",name:"name",id:"title-input",value:o,onChange:function(e){i(e.target.value)},className:"form__input add-card__title",placeholder:"Title",minLength:"2",maxLength:"30",required:!0}),r.a.createElement("span",{id:"title-input-error",className:"form__input-error"}),r.a.createElement("input",{type:"url",name:"link",id:"link-input",value:s,onChange:function(e){m(e.target.value)},className:"form__input add-card__image-link",placeholder:"Image URL",required:!0}),r.a.createElement("span",{id:"link-input-error",className:"form__input-error"}))};var N=function(e){return r.a.createElement(E,{title:"Are you sure?",name:"delete-card",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onConfirmDelete(e.card)},value:"Yes"})};var O=function(e){return null!==e.card?r.a.createElement("div",{className:"popup popup_dark popup_opened"},r.a.createElement("div",{className:"popup__container popup__container_photo"},r.a.createElement("span",{className:"popup__close",onClick:e.onClose},"+"),r.a.createElement("figure",{className:"photo"},r.a.createElement("img",{className:"photo__item",src:e.card.link,alt:e.card.name}),r.a.createElement("figcaption",{className:"photo__title"},e.card.name)))):r.a.createElement(r.a.Fragment,null)};var C=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.Provider,{value:e.currentUser},r.a.createElement(g,null,r.a.createElement("li",null,r.a.createElement(c.c,{to:"/",className:"menu__link",activeClassName:"menu__link_active"},e.username)),r.a.createElement("li",null,r.a.createElement(c.c,{to:"/signin",className:"menu__link",onClick:e.onSignOut},"Log out"))),r.a.createElement("main",{className:"main"},r.a.createElement("section",{className:"profile"},r.a.createElement("div",{className:"profile__person"},r.a.createElement("div",{className:"profile__avatar-wrapper"},r.a.createElement("img",{src:e.currentUser.avatar,alt:"User ptofile avatar",className:"profile__avatar"}),r.a.createElement("div",{className:"profile__avatar-hover",onClick:e.onEditAvatar})),r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info-wrapper"},r.a.createElement("h1",{className:"profile__name"},e.currentUser.name),r.a.createElement("button",{type:"button",className:"btn profile__edit-btn",onClick:e.onEditProfile})),r.a.createElement("p",{className:"profile__occupation"},e.currentUser.about))),r.a.createElement("button",{type:"button",className:"btn profile__add-btn",onClick:e.onAddPlace})),r.a.createElement("ul",{className:"gallery"},e.cards.map((function(t){return r.a.createElement(_,{card:t,key:t._id,cardLikes:t.likes,onCardClick:e.onSelectedCard,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete})})))),r.a.createElement(v,{isOpen:e.isEditProfilePopupOpen,onClose:e.closeAllPopups,onUpdateUser:e.handleUpdateUser}),r.a.createElement(b,{isOpen:e.isEditAvatarPopupOpen,onClose:e.closeAllPopups,onUpdateAvatar:e.handleUpdateAvatar}),r.a.createElement(k,{isOpen:e.isAddPlacePopupOpen,onClose:e.closeAllPopups,onAddPlace:e.handleAddPlace}),r.a.createElement(N,{isOpen:e.isDeleteConfirmationPopup,onClose:e.closeAllPopups,onConfirmDelete:e.handleConfirmDelete}),r.a.createElement(O,{isOpen:e.isPopupWithImageOpen,card:e.selectedCard,onClose:e.closeAllPopups})))},j=a(20),S=a(21),y=function(){function e(t){var a=t.baseUrl,n=t.headers;Object(j.a)(this,e),this.baseUrl=a,this.headers=n}return Object(S.a)(e,[{key:"getInitialCards",value:function(){return fetch(this.baseUrl+"/cards",{headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"getUserInfo",value:function(){return fetch(this.baseUrl+"/users/me",{headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"addCard",value:function(e){var t=e.name,a=e.link;return fetch(this.baseUrl+"/cards",{headers:this.headers,method:"POST",body:JSON.stringify({name:t,link:a})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"removeCard",value:function(e){return fetch(this.baseUrl+"/cards/"+e,{headers:this.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status," ").concat(e.message))}))}},{key:"getAppInfo",value:function(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}},{key:"addLike",value:function(e){return fetch(this.baseUrl+"/cards/likes/"+e,{headers:this.headers,method:"PUT"}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"removeLike",value:function(e){return fetch(this.baseUrl+"/cards/likes/"+e,{headers:this.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"changeLikeCardStatus",value:function(e,t){t?this.removeLike(e):this.addLike(e)}},{key:"updateUserInfo",value:function(e){var t=e.name,a=e.about;return fetch(this.baseUrl+"/users/me",{headers:this.headers,method:"PATCH",body:JSON.stringify({name:t,about:a})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}},{key:"setUserAvatar",value:function(e){return fetch(this.baseUrl+"/users/me/avatar",{headers:this.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status," ").concat(e.message))}))}}]),e}();var w=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"loader"},r.a.createElement("i",{className:"fa fa-cog fa-spin"})))};var P=function(e){return r.a.createElement("form",{action:"#",method:"post",className:"form ".concat(e.name),name:"".concat(e.name),onSubmit:e.onSubmit,noValidate:!0},r.a.createElement("h2",{className:"".concat(e.name,"__heading")},e.title),e.children,r.a.createElement("input",{type:"submit",name:"save",className:"btn form__submit ".concat(e.name,"__save"),value:e.value}))};var U=function(e){return r.a.createElement("div",{className:"popup ".concat(e.isOpen?"popup_opened":"")},r.a.createElement("div",{className:"popup__container"},r.a.createElement("span",{className:"popup__close",onClick:e.onClose},"+"),r.a.createElement("div",{className:"".concat(e.name," ").concat(e.name,"__icon ").concat(e.isRegistered?"".concat(e.name,"__icon_state_yes"):"".concat(e.name,"__icon_state_no")," ")},r.a.createElement("h2",{className:"".concat(e.name,"__heading")},e.title))))};var A=function(e){var t=Object(n.useState)(""),a=Object(u.a)(t,2),o=a[0],i=a[1],l=Object(n.useState)(""),s=Object(u.a)(l,2),m=s[0],p=s[1],d=Object(n.useState)(!1),f=Object(u.a)(d,2),h=f[0],_=f[1],E=Object(n.useState)(!1),v=Object(u.a)(E,2),b=v[0],k=v[1];return Object(n.useEffect)((function(){_(e.isRegistered),k(e.isInfoToolTip)}),[e.isRegistered,e.isInfoToolTip]),r.a.createElement(r.a.Fragment,null,r.a.createElement(g,null,r.a.createElement("li",null,r.a.createElement(c.c,{to:"/signin",className:"menu__link"},"Log In"))),r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"main__container"},r.a.createElement(P,{title:"Sign Up",name:"login",id:"login",onSubmit:function(t){t.preventDefault(),function(e){e.currentTarget.reset()}(t),e.handleSignup(o,m)},value:"Sign up"},r.a.createElement("input",{type:"email",name:"email",id:"email-input",className:"form__input login__email",placeholder:"Email",onChange:function(e){i(e.target.value)},required:!0}),r.a.createElement("span",{id:"email-input-error",className:"form__input-error"}),r.a.createElement("input",{type:"password",name:"password",id:"password-input",className:"form__input login__password",placeholder:"Password",onChange:function(e){p(e.target.value)},required:!0}),r.a.createElement("span",{id:"password-input-error",className:"form__input-error"})),r.a.createElement(c.b,{className:"login__link",to:"/signin"},"Already a member? Log in here"))),h?r.a.createElement(U,{name:"tool-tip",isRegistered:h,isOpen:b,title:"Success! You have now been registered.",onClose:e.onCloseToolTip}):r.a.createElement(U,{isOpen:b,isRegistered:h,title:"Oops, something went wrong! Please try again.",name:"tool-tip",onClose:e.onCloseToolTip}))},L=200,T=400,I=401;var D=function(e){var t=r.a.useState(""),a=Object(u.a)(t,2),n=a[0],o=a[1],i=r.a.useState(""),l=Object(u.a)(i,2),s=l[0],m=l[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(g,null,r.a.createElement("li",null,r.a.createElement(c.c,{to:"/signup",className:"menu__link"},"Sign Up"))),r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"main__container"},r.a.createElement(P,{title:"Log in",name:"login",id:"login",onSubmit:function(t){t.preventDefault(),e.handleLogin(n,s),function(e){e.currentTarget.reset()}(t)},value:"Log in",isOpen:"true"},r.a.createElement("input",{type:"email",name:"email",id:"email-input",className:"form__input login__email",placeholder:"Email",onChange:function(e){o(e.target.value)},required:!0}),r.a.createElement("span",{id:"email-input-error",className:"form__input-error"}),r.a.createElement("input",{type:"password",name:"password",id:"password-input",className:"form__input login__password",placeholder:"Password",onChange:function(e){m(e.target.value)},required:!0}),r.a.createElement("span",{id:"password-input-error",className:"form__input-error"})),r.a.createElement(c.b,{className:"login__link",to:"/signup"},"Not a member yet? Sign up here!"))))};var x=function(){var e=r.a.useState(!1),t=Object(u.a)(e,2),a=t[0],n=t[1],o=r.a.useState(!1),i=Object(u.a)(o,2),c=i[0],p=i[1],h=r.a.useState(!1),_=Object(u.a)(h,2),g=_[0],E=_[1],v=r.a.useState(!1),b=Object(u.a)(v,2),k=b[0],N=b[1],O=r.a.useState(!1),j=Object(u.a)(O,2),S=j[0],P=j[1],U=r.a.useState(!0),x=Object(u.a)(U,2),q=x[0],R=x[1],J=r.a.useState(null),F=Object(u.a)(J,2),B=F[0],W=F[1],z=r.a.useState(null),H=Object(u.a)(z,2),V=H[0],Y=H[1],G=r.a.useState([]),M=Object(u.a)(G,2),$=M[0],K=M[1],Q=r.a.useState([]),X=Object(u.a)(Q,2),Z=X[0],ee=X[1],te=r.a.useState({}),ae=Object(u.a)(te,2),ne=ae[0],re=ae[1],oe=r.a.useState(!1),ie=Object(u.a)(oe,2),ce=ie[0],le=ie[1],se=r.a.useState(""),ue=Object(u.a)(se,2),me=ue[0],pe=ue[1],de=r.a.useState(!1),fe=Object(u.a)(de,2),he=fe[0],_e=fe[1],ge=r.a.useState(!1),Ee=Object(u.a)(ge,2),ve=Ee[0],be=Ee[1],ke=r.a.useState(localStorage.getItem("jwt")),Ne=Object(u.a)(ke,2),Oe=Ne[0],Ce=Ne[1],je=new y({baseUrl:"",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Oe)}}),Se=Object(m.g)();function ye(){E(!1),n(!1),p(!1),W(null),N(!1),be(!1)}return r.a.useEffect((function(){var e=localStorage.getItem("jwt");e?(R(!0),function(e){return fetch("".concat("","/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(e.status===I){var t=new Error;return t.message=String(I),t}return e.json()})).then((function(e){return e}))}(e).then((function(t){if(t instanceof Error&&t.message===String(I))throw new Error("The provided token is invalid.");le(!0),pe(t.email),Ce(e)})).then((function(){return Se.push("/")})).catch((function(e){return console.log(e)})).finally((function(){return R(!1)}))):(Se.push("/signin"),R(!1))}),[]),r.a.useEffect((function(){ce&&Oe&&(R(!0),je.getAppInfo().then((function(e){re(e[1]),K(e[0])})).catch((function(e){return console.log(e)})).finally((function(){return R(!1)})))}),[Oe,ce]),r.a.createElement("div",{className:"page"},q&&r.a.createElement(w,null),r.a.createElement(m.d,null,r.a.createElement(m.b,{path:"/signup"},r.a.createElement(A,{handleSignup:function(e,t){(function(e,t){return fetch("".concat("","/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){if(e.status===L)return e.json();var t=new Error;return t.message=String(T),t})).then((function(e){return e}))})(e,t).then((function(e){if(!(e instanceof Error))return _e(!0),e;if(e.message===String(T))throw _e(!1),new Error("One of the fields was filled in incorrectly")})).then((function(e){e instanceof Error||setTimeout((function(){ye(),Se.push("/signin")}),3e3)})).catch((function(e){return console.log(e)})).finally((function(){return be(!0)}))},onCloseToolTip:ye,isInfoToolTip:ve,isRegistered:he})),r.a.createElement(m.b,{path:"/signin"},r.a.createElement(D,{setUsername:pe,handleLogin:function(e,t){R(!0),function(e,t){return fetch("".concat("","/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){var t=new Error;return e.status===L?e.json():e.status===T?(t.message=String(T),t):e.status===I?(t.message=String(I),t):t})).then((function(e){return e}))}(e,t).then((function(t){if(t instanceof Error){if(le(!1),t.message===String(T))throw new Error("One or more of the fields were not provided.");if(t.message===String(I))throw new Error("The user with the specified email not found.")}else if(t.token)return localStorage.setItem("jwt",t.token),Ce(t.token),pe(e),le(!0),void Se.push("/")})).catch((function(e){return console.log(e)})).finally((function(){return R(!1)}))},setToken:Ce,setLoggedIn:le,setCards:K,setCurrentUser:re})),r.a.createElement(d,{path:"/",component:C,loggedIn:ce,onEditProfile:function(){n(!0)},onEditAvatar:function(){E(!0)},onAddPlace:function(){p(!0)},selectedCard:B,onSelectedCard:function(e){P(!0),W(e)},cardLikes:Z,cards:$,onCardLike:function(e){e.likes.some((function(e){return e===ne._id}))?(R(!0),je.removeLike(e._id).then((function(e){ee(e.likes)})).catch((function(e){return console.log(e)})).finally((function(){return R(!1)}))):(R(!0),je.addLike(e._id).then((function(e){ee(e.likes)})).catch((function(e){return console.log(e)})).finally((function(){return R(!1)})))},onCardDelete:function(e){N(!k),Y(e)},username:me,onSignOut:function(){localStorage.removeItem("jwt"),le(!1),pe(""),re({}),K([]),Se.push("/signin")},currentUser:ne,closeAllPopups:ye,isEditProfilePopupOpen:a,isAddPlacePopupOpen:c,isEditAvatarPopupOpen:g,isDeleteConfirmationPopup:k,isPopupWithImageOpen:S,handleUpdateUser:function(e){R(!0),ye(),je.updateUserInfo(e).then((function(e){re(Object(s.a)(Object(s.a)({},ne),{},{name:e.data.name,about:e.data.about}))})).catch((function(e){return console.log(e)})).finally((function(){R(!1)}))},handleUpdateAvatar:function(e){ye(),R(!0),je.setUserAvatar(e).then((function(e){re(Object(s.a)(Object(s.a)({},ne),{},{avatar:e.data.avatar}))})).catch((function(e){return console.log(e)})).finally((function(){R(!1)}))},handleAddPlace:function(e){ye(),R(!0),je.addCard(e).then((function(e){K([e].concat(Object(l.a)($)))})).catch((function(e){return console.log(e)})).finally((function(){R(!1)}))},handleConfirmDelete:function(){R(!0),ye(),k&&je.removeCard(V._id).then((function(e){var t=$.filter((function(e){return e._id!==V._id}));K(t)})).catch((function(e){return console.log(e)})).finally((function(){Y(null),R(!1)}))}}),r.a.createElement(m.b,{exact:!0,path:"/"},ce?r.a.createElement(m.a,{to:"/"}):r.a.createElement(m.a,{to:"/signin"}))),r.a.createElement(f,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c.a,null,r.a.createElement(x,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.e3d41e4d.chunk.js.map